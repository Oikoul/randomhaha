print("Executed afk script")
local running = false
local parts = {}
local changed = false
local dying = false
local transporting = false
local cam = game.Workspace.CurrentCamera
local UIS = game:GetService("UserInputService")
local plr = game.Players.LocalPlayer
local plot = game:GetService("Players").LocalPlayer.Values.Plot.Value
local character = plr.Character
local humanoid = character and character:FindFirstChildOfClass("Humanoid")
-------------------------------------------------
for _, v in pairs(workspace.Plots:GetChildren()) do
	if v.Name == tostring(plot) then
		plot = v
		print("Plot: "..plot.Name)
	end
end
--^^plot identification
local shaker = plot.Objects:FindFirstChild("Sandbed Shaker")
local furnace = plot.Objects:FindFirstChild("Basic Furnace").Hitbox

UIS.InputEnded:Connect(function(k)
	if k.KeyCode == Enum.KeyCode.F1 then
		if running then
			running = false
			print("Stopped")
		else
			running = true
			print("Started")
		end
	end
	if k.KeyCode == Enum.KeyCode.F2 then
		if transporting then
			transporting = false
			print("Transporting stopped")
		else
			transporting = true
			print("Transporting started")
		end
	end
end)
spawn(function()
	while true do
		game.Players.LocalPlayer.MaximumSimulationRadius = math.pow(math.huge,math.huge)*math.huge
		sethiddenproperty(game.Players.LocalPlayer,"SimulationRadius",math.pow(math.huge,math.huge)*math.huge)
		game:GetService("RunService").Heartbeat:Wait()
	end
end)
spawn(function()
	while true do
		if running then
			for _, v in pairs(workspace.WorldSpawn:GetChildren()) do
				if v.Name == 'MineableRock' and v:FindFirstChild("RockString") and v.RockString.Value == "Sandstone" and v.Rock:FindFirstChild("Stage3") and running then
					for _, n in pairs(v.Rock.Stage3:GetChildren()) do
						if n and n.Name == "Part" and running and humanoid and humanoid.Health == 100 then
							repeat
								if v:FindFirstChild("Part") ~= nil then
									plr.Character.HumanoidRootPart.CFrame = v.Part.CFrame + Vector3.new(0, 2, 0)
									wait(.1)
									cam.CFrame = CFrame.new(cam.CFrame.Position, n.Position)
									wait(.1)
								end
							until n == nil or not n.Parent or running == false or humanoid.Health < 100
						end
					end
				end
			end
		end
		wait(1)
	end
end)
spawn(function()
	while true do
		if transporting then
			--stage 1
			for _, v in pairs(workspace.Grabable:GetChildren()) do
				if v.Name == "MaterialPart" and v:FindFirstChild("Configuration") and v.Configuration:FindFirstChild("Data") and v.Configuration.Data:FindFirstChild("MatInd") and v.Configuration.Data.MatInd.Value == "Sandstone" then
					if  v:FindFirstChild("Part") and v.Part:FindFirstChild("BodyPosition") ~= nil then
						v.Part.BodyPosition:Destroy()
					end
					local bp = Instance.new("BodyPosition")
					bp.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
					bp.Parent = v.Part
					bp.Position = furnace.Position
					v.Part.CanCollide = false
					table.insert(parts, v)
				end
			end
			--stage 2
			wait(10)
			for _, v in pairs(parts) do
				if v then
					if  v:FindFirstChild("Part") and v.Part:FindFirstChild("BodyPosition") ~= nil then
						local bp = v.Part.BodyPosition
						local xx = plot.Objects:FindFirstChild("Sandbed Shaker"):FindFirstChild("Hitbox").CFrame * CFrame.new(0, 0.6, 0)
						local zz = plot.Objects:FindFirstChild("Sandbed Shaker"):FindFirstChild("Hitbox").CFrame * CFrame.new(0, 0.6, 0)
						bp.Position = Vector3.new(xx.x, plot.Objects:FindFirstChild("Sandbed Shaker"):FindFirstChild("Hitbox").Position.Y, zz.z)
					end
				end
			end
			wait(15)
			--stage 3
			if dying == false and running == true then
				running = false
				changed = true
				wait(.2)
			end
			for _, v in pairs(parts) do
				if v then
					if v:FindFirstChild("Part") then
						if v.Part:FindFirstChild("BodyPosition") ~= nil then
							v.Part.CanCollide = false
							v.Part.BodyPosition.Position = Vector3.new(-437, 3, -91)
							plr.Character.HumanoidRootPart.Cframe = v.Part.CFrame
							local args1 = {[1] = v.Part,[2] = {}}
							game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("Grab"):InvokeServer(unpack(args1))
						else
							local bp = Instance.new("BodyPosition")
							bp.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
							bp.Parent = v.Part
							v.Part.CanCollide = false
							bp.Position = Vector3.new(-437, 3, -91)
							plr.Character.HumanoidRootPart.Cframe = v.Part.CFrame
							local args1 = {[1] = v.Part,[2] = {}}
							game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("Grab"):InvokeServer(unpack(args1))
						end
						local args2 = {[1] = v.Part,[3] = {}}
						game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("Ungrab"):FireServer(unpack(args2))
						table.clear(parts)
					end
				end
			end
			if changed == true then
				changed = false
				running = true
			end
			wait(10)
			workspace:WaitForChild("Map"):WaitForChild("Sellary"):WaitForChild("Keeper"):WaitForChild("IPart"):WaitForChild("Interact"):FireServer()
			--safety
			if plot.Objects:FindFirstChild("Packager") then
				plot:WaitForChild("Objects"):WaitForChild("Packager"):WaitForChild("Hitbox"):WaitForChild("Interact"):FireServer()
			end
		end
		wait(1)
	end
end)
spawn(function()
	while true do
		if plr.Character and plr.Character:FindFirstChild("Humanoid") then
			if humanoid.Health < 100 then
				dying = true
				local args = {[1] = "ResetInit"}
				game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("ClientEvent"):FireServer(unpack(args))
				wait(7)
				game:GetService("Players").LocalPlayer.Backpack["Duality Pickaxe"].Parent = game.Players.LocalPlayer.Character
				dying = false
			end
		end
		wait(1)
	end
end)
